"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.rollupInitGenerator = void 0;
const devkit_1 = require("@nx/devkit");
const versions_1 = require("../../utils/versions");
const add_plugin_1 = require("@nx/devkit/src/utils/add-plugin");
const plugin_1 = require("../../plugins/plugin");
async function rollupInitGenerator(tree, schema) {
    let task = () => { };
    if (!schema.skipPackageJson) {
        task = (0, devkit_1.addDependenciesToPackageJson)(tree, {}, { '@nx/rollup': versions_1.nxVersion }, undefined, schema.keepExistingVersions);
    }
    schema.addPlugin ??= process.env.NX_ADD_PLUGINS !== 'false';
    if (schema.addPlugin) {
        await (0, add_plugin_1.addPlugin)(tree, await (0, devkit_1.createProjectGraphAsync)(), '@nx/rollup/plugin', plugin_1.createNodes, {
            buildTargetName: ['build', 'rollup:build', 'rollup-build'],
        }, schema.updatePackageScripts);
    }
    if (!schema.skipFormat) {
        await (0, devkit_1.formatFiles)(tree);
    }
    return task;
}
exports.rollupInitGenerator = rollupInitGenerator;
exports.default = rollupInitGenerator;
